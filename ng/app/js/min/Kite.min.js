"use strict";function TheKite(t,e,i){this.summedCons=t,this.firstYear=e,this.firstWeek=i}Kite.sumConsumptions=function(t){for(var e=[],i=0;i<t[0].dwelling.savings.length;i++)e[i]=0;var o=0;t.forEach(function(t){o+=t.dwelling.surface;var i=t.dwelling.savings.slice();i.reverse(),i.forEach(function(i,o){var s=i.heatingCons>0?i.heatingCons*t.dwelling.surface:0,n=.045*i.waterCons,r=i.hotWaterCons*t.dwelling.surface;e[o]+=s+i.electricityCons+n+r})});for(var i=1;i<e.length;i++)e[i]+=e[i-1];for(var i=0;i<e.length;i++)e[i]=e[i]/o;return e},TheKite.prototype.getPosition=function(t){return new paper.Point(this.getX(t),this.getY(this.summedCons[t]))},TheKite.prototype.getX=function(t){return paper.view.bounds.width*t/52+paper.view.bounds.x},TheKite.prototype.getY=function(t){var e=151;return.6*paper.view.bounds.height*(1-t/e)+paper.view.bounds.y},TheKite.prototype.draw=function(t){var e=t-this.firstWeek;(e<this.summedCons.length-1||this.animationDone)&&this.drawWeek(e),this.computeLine(e)},TheKite.prototype.drawWeek=function(t){var e,i=this.getPosition(t);if(t>0)var e=this.getPosition(t-1);this.drawItem(e,i)},TheKite.prototype.drawItem=function(t,e){var i=this;if(this.kiteItem){this.kiteItem.position=e,this.mouseItem.position=e,this.kiteItem.bringToFront(),this.mouseItem.bringToFront();var o=this.path.clone();o.visible=!1;var s=o.getLocationOf(e);s&&t&&(o.split(s),o.segments.length>7&&o.removeSegments(0,o.segments.length-7)),this.shortTail&&this.shortTail.remove(),this.shortTail=new paper.Path(o.segments),this.shortTail.strokeColor=new paper.Color(255,255,255,.7),this.shortTail.visible=!0,o.remove()}else this.kiteItem=Kite.symbol.place(e),this.kiteItem.scale(1.5),this.mouseItem=new paper.Path.Rectangle(this.kiteItem.bounds),this.mouseItem.fillColor=new paper.Color(0,0,0,0),this.mouseItem.onMouseEnter=function(){document.body.style.cursor="pointer",i.mouseIn=!0},this.mouseItem.onMouseLeave=function(){document.body.style.cursor="default",i.mouseIn=!1},this.mouseItem.onClick=function(){console.log("click"),document.body.style.cursor="default",i.setLineVisible(!i.path.visible),i.onKiteClicked&&i.onKiteClicked()};if(t){var n=Math.atan((e.y-t.y)/(e.x-t.x)),r=180*n/Math.PI;this.kiteItem.rotation=r}},TheKite.prototype.computeLine=function(t){this.path=new paper.Path,this.path.visible=!1,this.path.strokeColor="white",this.path.strokeWidth=1;for(var e=0;t>e;e++)this.path.add(this.getPosition(e));this.path.smooth(),this.path.add(this.getPosition(t))},TheKite.prototype.setLineVisible=function(t){this.path.visible=t},TheKite.prototype.stopAnimateTimer=function(){angular.isDefined(this.animateTimer)&&(this.$interval.cancel(this.animateTimer),this.animateTimer=void 0)},TheKite.prototype.animate=function(t,e){var i=this;this.$interval=t,this.animationDone=!0;var o=0;this.animateTimer=t(function(){var t=i.path.getPointAt(o);o++;var e=i.path.getPointAt(o);e&&t&&e.y<t.y&&i.drawItem(t,e)},30,this.path.length-1),e.$on("$destroy",function(){i.stopAnimateTimer()})};